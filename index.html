<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Explored by the Shaws</title>

  <!-- Google Font for Modern Look -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;500;600&display=swap" rel="stylesheet" />

  <!-- Set SVG Favicon -->
  <link rel="icon" href="favicon.svg" type="image/svg+xml" />

  <style>
    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #ffffff;
      color: #1c1c1e;
    }

    header {
      display: flex;
      align-items: center;
      padding: 1.5rem 2rem;
      gap: 0.75rem;
    }

    .logo svg {
      height: 42px;
      width: 42px;
      fill: #007aff;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 100;
      margin: 0;
      line-height: 1.1;
    }

    .map-container {
      width: 100%;
      height: calc(100vh - 90px);
      position: relative;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    @media (max-width: 600px) {
      header {
        padding: 1rem;
        gap: 0.5rem;
      }

      .logo svg {
        height: 26px;
        width: 26px;
      }

      h1 {
        font-size: 1.8rem;
      }
    }
  </style>
  <script>
    let map;
    const layers = {};

    function initMap() {
      map = new google.maps.Map(document.querySelector(".map-container"), {
        center: { lat: 39.8283, lng: -98.5795 }, // Center of the US
        zoom: 4,
      });
    }

    function getOrCreateLayer(year) {
      if (!layers[year]) {
        layers[year] = new google.maps.Data({ map });
      }
      return layers[year];
    }

    async function geocodeLocation(location) {
      const response = await fetch(
        `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(location)}&key=AIzaSyD4onh-91wzzcsGdBkJxVJ-U6FYnFo3ebQ`
      );
      const data = await response.json();
      if (data.status === "OK") {
        return data.results[0].geometry.location;
      } else {
        throw new Error(`Location not found: ${location}`);
      }
    }

    async function handleFormSubmit(event) {
      event.preventDefault();

      // Get form values
      const name = document.getElementById("name").value;
      const month = document.getElementById("month").value;
      const description = document.getElementById("description").value;
      const location = document.getElementById("location").value;
      const year = document.getElementById("year").value;

      try {
        // Geocode the location to get latitude and longitude
        const { lat, lng } = await geocodeLocation(location);

        // Add the pin to the correct layer
        const layer = getOrCreateLayer(year);
        layer.add({
          geometry: new google.maps.Data.Point({ lat, lng }),
          properties: { name, month, description },
        });

        // Display success message
        alert(`Pin added successfully:\nName: ${name}\nMonth: ${month}\nDescription: ${description}\nLocation: ${location}\nCoordinates: (${lat}, ${lng})\nYear: ${year}`);

        // Reset the form
        event.target.reset();
      } catch (error) {
        alert("Error: " + error.message);
      }
    }

    window.initMap = initMap;
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4onh-91wzzcsGdBkJxVJ-U6FYnFo3ebQ&callback=initMap"></script>
</head>
<body>
  <header>
    <div class="logo">
      <!-- Clean GPS Pin SVG -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
        <path d="M192 0C86 0 0 86 0 192c0 77.4 108.7 215.3 162.7 276.4 15.5 17.6 42.1 17.6 57.6 0C275.3 407.3 384 269.4 384 192 384 86 298 0 192 0zm0 272a80 80 0 1 1 0-160 80 80 0 1 1 0 160z"/>
      </svg>
    </div>
    <h1>Explored by the Shaws</h1>
  </header>

  <div class="map-container"></div>

  <div style="padding: 2rem;">
    <h2>Add a New Location</h2>
    <form onsubmit="handleFormSubmit(event)" style="display: flex; flex-direction: column; gap: 1rem; max-width: 400px;">
      <label>
        Name:
        <input type="text" id="name" required style="width: 100%; padding: 0.5rem; font-size: 1rem;" />
      </label>
      <label>
        Month:
        <input type="text" id="month" required style="width: 100%; padding: 0.5rem; font-size: 1rem;" />
      </label>
      <label>
        Description:
        <textarea id="description" required style="width: 100%; padding: 0.5rem; font-size: 1rem;"></textarea>
      </label>
      <label>
        Location (City/State or Address):
        <input type="text" id="location" required style="width: 100%; padding: 0.5rem; font-size: 1rem;" />
      </label>
      <label>
        Year:
        <select id="year" required style="width: 100%; padding: 0.5rem; font-size: 1rem;">
          <option value="2023">2023</option>
          <option value="2024">2024</option>
          <option value="2025">2025</option>
        </select>
      </label>
      <button type="submit" style="padding: 0.75rem; font-size: 1rem; background-color: #007aff; color: white; border: none; cursor: pointer;">Add Location</button>
    </form>
  </div>
</body>
</html>
