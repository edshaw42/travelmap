<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Explored by the Shaws</title>

  <!-- Google Font for Modern Look -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;500;600&display=swap" rel="stylesheet" />

  <!-- Set SVG Favicon -->
  <link rel="icon" href="favicon.svg" type="image/svg+xml" />

  <style>
    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #ffffff;
      color: #1c1c1e;
    }

    header {
      display: flex;
      align-items: center;
      padding: 1.5rem 2rem;
      gap: 0.75rem;
    }

    .logo svg {
      height: 42px;
      width: 42px;
      fill: #007aff;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 100;
      margin: 0;
      line-height: 1.1;
    }

    .map-container {
      width: 100%;
      height: calc(100vh - 90px);
      position: relative;
    }

    .map-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      cursor: crosshair;
    }

    @media (max-width: 600px) {
      header {
        padding: 1rem;
        gap: 0.5rem;
      }

      .logo svg {
        height: 26px;
        width: 26px;
      }

      h1 {
        font-size: 1.8rem;
      }
    }
  </style>
  <script>
    const SHEET_ID = "1wvENHweG4e16n514x2zUR-NJmhp3IrUPxTQUFaGRgg0"; // Google Sheet ID
    const API_KEY = "AIzaSyD4onh-91wzzcsGdBkJxVJ-U6FYnFo3ebQ"; // Your provided API key

    let map; // Ensure map is globally accessible

    async function fetchPins() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Sheet1?key=${API_KEY}`;
      const response = await fetch(url);
      const data = await response.json();

      if (data.values) {
        const rows = data.values.slice(1); // Skip header row
        rows.forEach(([year, lat, lng, name, description]) => {
          addPinToMap({
            year,
            lat: parseFloat(lat),
            lng: parseFloat(lng),
            name,
            description,
          });
        });
      }
    }

    async function addPinToSheet(pin) {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Sheet1:append?valueInputOption=USER_ENTERED&key=${API_KEY}`;
      const response = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          values: [[pin.year, pin.lat, pin.lng, pin.name, pin.description]],
        }),
      });

      if (!response.ok) {
        alert("Failed to save pin to Google Sheets.");
      }
    }

    function addPinToMap({ year, lat, lng, name, description }) {
      const color = getColorByYear(year);

      const marker = new google.maps.marker.AdvancedMarkerElement({
        position: { lat, lng },
        map,
        title: name,
        content: `<div style="background-color: ${color}; width: 12px; height: 12px; border-radius: 50%;"></div>`
      });

      marker.addListener("click", () => {
        alert(`Name: ${name}\nDescription: ${description}\nYear: ${year}`);
      });
    }

    function getColorByYear(year) {
      const colors = {
        2023: "#FF0000",
        2024: "#00FF00",
        2025: "#0000FF",
      };
      return colors[year] || "#000000";
    }

    async function handleFormSubmit(event) {
      event.preventDefault();

      const name = document.getElementById("name").value;
      const month = document.getElementById("month").value;
      const description = document.getElementById("description").value;
      const year = document.getElementById("year").value;
      const lat = parseFloat(document.getElementById("latitude").value);
      const lng = parseFloat(document.getElementById("longitude").value);

      const pin = { year, lat, lng, name, description };

      addPinToMap(pin);
      await addPinToSheet(pin);

      alert("Pin added successfully!");
      event.target.reset();
      document.getElementById("location-form-container").style.display = "none";
    }

    function initMap() {
      // Clear any existing content in the map container
      const mapContainer = document.querySelector(".map-container");
      mapContainer.innerHTML = "";

      // Initialize the map
      map = new google.maps.Map(mapContainer, {
        center: { lat: 39.8283, lng: -98.5795 }, // Center of the US
        zoom: 4,
      });

      // Fetch and display existing pins from Google Sheets
      fetchPins();

      // Add a click listener to the map
      map.addListener("click", (event) => {
        const lat = event.latLng.lat();
        const lng = event.latLng.lng();

        // Pre-fill the form with the clicked coordinates
        document.getElementById("latitude").value = lat.toFixed(6);
        document.getElementById("longitude").value = lng.toFixed(6);

        // Show the form as a modal
        const formContainer = document.getElementById("location-form-container");
        formContainer.style.display = "block";
        formContainer.style.position = "fixed";
        formContainer.style.top = "50%";
        formContainer.style.left = "50%";
        formContainer.style.transform = "translate(-50%, -50%)";
        formContainer.style.backgroundColor = "white";
        formContainer.style.padding = "2rem";
        formContainer.style.boxShadow = "0 4px 6px rgba(0, 0, 0, 0.1)";
        formContainer.style.zIndex = "1000";
      });
    }

    window.initMap = initMap;
    window.onload = fetchPins;
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4onh-91wzzcsGdBkJxVJ-U6FYnFo3ebQ&callback=initMap&libraries=marker"></script>
</head>
<body>
  <header>
    <div class="logo">
      <!-- Clean GPS Pin SVG -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
        <path d="M192 0C86 0 0 86 0 192c0 77.4 108.7 215.3 162.7 276.4 15.5 17.6 42.1 17.6 57.6 0C275.3 407.3 384 269.4 384 192 384 86 298 0 192 0zm0 272a80 80 0 1 1 0-160 80 80 0 1 1 0 160z"/>
      </svg>
    </div>
    <h1>Explored by the Shaws</h1>
  </header>

  <div class="map-container" style="position: relative; height: calc(100vh - 90px);"></div>

  <div id="location-form-container" style="display: none;">
    <h2>Add a New Location</h2>
    <form onsubmit="handleFormSubmit(event)" style="display: flex; flex-direction: column; gap: 1rem; max-width: 400px;">
      <label>
        Name:
        <input type="text" id="name" required style="width: 100%; padding: 0.5rem; font-size: 1rem;" />
      </label>
      <label>
        Month:
        <input type="text" id="month" required style="width: 100%; padding: 0.5rem; font-size: 1rem;" />
      </label>
      <label>
        Description:
        <textarea id="description" required style="width: 100%; padding: 0.5rem; font-size: 1rem;"></textarea>
      </label>
      <label>
        Year:
        <select id="year" required style="width: 100%; padding: 0.5rem; font-size: 1rem;">
          <option value="2023">2023</option>
          <option value="2024">2024</option>
          <option value="2025">2025</option>
        </select>
      </label>
      <label>
        Latitude:
        <input type="text" id="latitude" readonly style="width: 100%; padding: 0.5rem; font-size: 1rem; background-color: #f0f0f0;" />
      </label>
      <label>
        Longitude:
        <input type="text" id="longitude" readonly style="width: 100%; padding: 0.5rem; font-size: 1rem; background-color: #f0f0f0;" />
      </label>
      <button type="submit" style="padding: 0.75rem; font-size: 1rem; background-color: #007aff; color: white; border: none; cursor: pointer;">Add Location</button>
    </form>
  </div>
</body>
</html>
